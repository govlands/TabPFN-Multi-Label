GitHub Copilot

下面列出你可以继续做的工作，按优先级与可执行性给出简短说明与产出预期。需要我代写或修改哪一项请告诉我具体文件/位置，我会直接给出补丁。

高优先（修复与可靠性）
- 修复 dtype 一致性：在所有从 numpy -> torch 的地方显式使用 dtype=torch.float32（避免训练/推理不一致的 Double/Float 错误）。产出：一处或多处小改动。
- 规范 predict_proba 解析：改进 formalize_output_probas，使其使用每个子分类器的 classes_ 定位正类列并在找不到时报错或打印警告。产出：更稳健的概率矩阵。
- 处理 TabPFN 客户端限制：在 tabpfn_pred_probas 中加入下采样逻辑或环境变量提示，并返回被下采样的 test 索引，以保证可重复性。产出：不会因为服务限制失败。
- 修复模型加载路径检查：当 model_path 为空时跳过或提示，避免 FileNotFoundError。产出：更友好的运行流程。

模型改进与评估
- 加入概率校准（CalibratedClassifierCV）用于 XGB/GBDT 或 LR，提升 AUC/stacking 稳定性。产出：校准后概率矩阵。
- 用交叉验证/重复实验替代单次拆分，收集指标均值与置信区间（或 boxplot 用于可视化）。产出：更可信的比较结果。
- 自动阈值优化：对每个标签按 validation 集优化阈值（F1 最大化），比 0.5 更合理。产出：提升 F1/hamming/subset acc。
- 堆叠/元学习实验：把多基线的 predict_proba 作为二级输入训练 MLPWithAttention 或简单 LR 作为对照。产出：端到端堆叠 pipeline。

可视化与报告
- 改进可视化：把箱线图改为按模型/指标的 violin 或 PR 曲线，单独保存每对图（已做分组，可再细化）。产出：更易解释的图表集合。
- 每标签报告：为每个标签生成混淆矩阵、PR 曲线、AUC，便于发现难学标签。产出：标签级诊断报告。
- 自动化 HTML 报告：把指标表 + 图表打包为一个可分享的 HTML。产出：共享报告文件。

性能与工程
- 为 GBDT 加入 early_stopping_rounds（XGB/LightGBM）和验证集，避免浪费计算。产出：更快更稳训练。
- 调参自动化：加入简单的 GridSearch / RandomizedSearch 或 Optuna 进行 n_estimators、max_depth、lr 调参。产出：更优超参。
- GPU 加速：若可用，把 PyTorch/GBDT 放到 GPU（XGBoost tree_method='gpu_hist'），加速大数据试验。产出：训练时间下降。
- 单元测试与 CI：为关键函数（formalize_output_probas、evaluate_multilabel、tabpfn_pred_probas）写小的 unit tests。产出：更可靠的重构基础。

工程化与重用
- 把数据加载、训练、评估、可视化封装为 CLI 或 notebook（便于实验复现）。产出：易用的实验脚本或 Notebook。
- 保存/记录实验：集成简单的日志/JSON 保存每次实验配置与结果（timestamped）。产出：可追溯的实验历史。

我可以马上帮你做（选项，任选其一）
1. 修复 baseline_test.py 中 formalize_output_probas 为 classes_ 定位并提交补丁。  
2. 在 mlp_att.predict 中加上 dtype 强制转换并提交补丁。  
3. 为 visualize_model_comparison 再做微调（每图单独保存、更多图表类型）。  
4. 写一个阈值优化脚本（每标签在验证集上搜索最佳阈值并应用到测试集）。

你想我现在做哪一项？请回复数字或描述你优先的任务。